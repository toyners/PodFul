<Window x:Class="PodFul.WPF.Testbed.TileListWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PodFul.WPF.Testbed"
        xmlns:viewmodel="clr-namespace:PodFul.WPF.Testbed.ViewModel"
        mc:Ignorable="d"
        Title="Tile List" Height="600" Width="1000" 
        MinHeight="150" MinWidth="150"
        WindowStartupLocation="CenterScreen">
  <Window.Resources>
    <SolidColorBrush x:Key="GlyphBrush" Color="#444" />
    <ControlTemplate x:Key="toggleButtonTemplate" TargetType="ToggleButton">
      <Grid
            Width="15"
            Height="13"
            Background="Transparent">
        <Path x:Name="ExpandPath"
              HorizontalAlignment="Left" 
              VerticalAlignment="Center" 
              Margin="1,1,1,1"
              Fill="{StaticResource GlyphBrush}"
              Data="M 4 0 L 8 4 L 4 8 Z"/>
      </Grid>
      <ControlTemplate.Triggers>
        <Trigger Property="IsChecked"
                 Value="True">
          <Setter Property="Data"
                  TargetName="ExpandPath"
                  Value="M 0 4 L 8 4 L 4 8 Z"/>
        </Trigger>
      </ControlTemplate.Triggers>
    </ControlTemplate>
    <Style x:Key="toggleButtonStyle" TargetType="ToggleButton">
      <Setter Property="Template" Value="{StaticResource toggleButtonTemplate}" />
    </Style>
  </Window.Resources>

  <DockPanel Margin="5">
    
    <!-- Feed and Scan action bar --> 
    <Border BorderBrush="Black" BorderThickness="1" DockPanel.Dock="Bottom">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition />
          <ColumnDefinition />
        </Grid.ColumnDefinitions>

        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center" >
          <Button Width="70" Click="AddFeedButtonClick">Add</Button>
          <Button Name="RemoveButton" Width="70" Click="RemoveFeedClick" IsEnabled="False">Remove</Button>
        </StackPanel>

        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Column="1" >
          <Button Width="70" Click="SettingsButtonClick">Settings</Button>
          <Button Name="ScanButton" Width="70" Click="FullScanButtonClick" IsEnabled="False">Full Scan</Button>
        </StackPanel>
      </Grid>
    </Border>

    <!-- Feed tile list -->
    <Border Margin="0,0,0,5" BorderBrush="Black" BorderThickness="1">
      <ScrollViewer Name="FeedList_Scroller" VerticalScrollBarVisibility="Visible" >
        <ListBox Name="FeedList" HorizontalContentAlignment="Stretch" SelectionChanged="FeedList_SelectionChanged"
                   ScrollViewer.HorizontalScrollBarVisibility="Disabled" MouseDoubleClick="FeedList_MouseDoubleClick"
                   PreviewMouseWheel="FeedList_MouseWheel" ItemsSource="{Binding Feeds}">
          <ListBox.ItemTemplate>
            <DataTemplate>
              <Grid Margin="0,2">
                
                <!-- 
                Two rows: First row is feed title bar containing toggle button and feed title 
                Second row is the feed content panel and is collapsed by default. It contains the
                podcast list and feed settings.
                -->
                <Grid.RowDefinitions>
                  <RowDefinition />
                  <RowDefinition />
                </Grid.RowDefinitions>

                <!-- Feed title bar -->
                <Grid Grid.Row="0">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="25" />
                    <ColumnDefinition />
                  </Grid.ColumnDefinitions>

                  <ToggleButton Name="MainToggleButton" Height="20" Width="20" Style="{StaticResource toggleButtonStyle}" />

                  <TextBlock Grid.Column="1" FontWeight="Bold" FontSize="14" Text="{Binding Title, Mode=OneWay}" />
                </Grid>

                <!-- Feed content panel -->
                <Grid Grid.Row="1" Margin="0,2">
                  
                  <!-- 
                  Grid is styled to be collapsed initally (i.e. MainToggleButton.IsChecked = false). 
                  When the MainToggleButton.IsChecked = true then the grid is made visible (i.e. expanded)
                  -->
                  <Grid.Style>
                    <Style TargetType="Grid">
                      <Setter Property="Visibility" Value="Collapsed"/>
                      <Style.Triggers>
                        <DataTrigger Binding="{Binding ElementName=MainToggleButton, Path=IsChecked}" Value="True">
                          <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                      </Style.Triggers>
                    </Style>
                  </Grid.Style>

                  <!-- Dock panel contains Settings, Podcast list and podcast page navigation controls -->
                  <DockPanel Margin="0,2" DataContext="{Binding Navigation}">

                      <Grid DockPanel.Dock="Bottom">
                        <Grid.RowDefinitions>
                          <RowDefinition />
                          <RowDefinition />
                        </Grid.RowDefinitions>

                        <!-- Settings toggle and title panel -->
                        <Grid Grid.Row="0">
                          <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="25" />
                            <ColumnDefinition />
                          </Grid.ColumnDefinitions>
                          <ToggleButton Name="SettingsToggleButton" Height="20" Width="20" Style="{StaticResource toggleButtonStyle}" />

                          <TextBlock Grid.Column="1" FontWeight="Bold" FontSize="14" Text="Settings" />
                        </Grid>

                        <!-- Settings expandable panel -->
                        <Grid Grid.Row="1">
                      </Grid>
                      </Grid>

                      <StackPanel Orientation="Horizontal" DockPanel.Dock="Bottom">
                        <Button IsEnabled="{Binding CanMoveBack}" Click="FirstPageClick">First</Button>
                        <Button IsEnabled="{Binding CanMoveBack}" Click="PreviousPageClick">Previous</Button>
                        <TextBox Text="{Binding PageNumber, Mode=TwoWay}"/>
                        <TextBlock> of</TextBlock>
                        <TextBlock Text="{Binding TotalPages}" />
                        <Button IsEnabled="{Binding CanMoveForward}" Click="NextPageClick">Next</Button>
                        <Button IsEnabled="{Binding CanMoveForward}" Click="LastPageClick">Last</Button>
                      </StackPanel>

                      <ListBox DataContext="{Binding CurrentPage}" ItemsSource="{Binding Podcasts}" HorizontalContentAlignment="Stretch">
                        <ListBox.ItemTemplate>
                          <DataTemplate DataType="{x:Type viewmodel:PodcastViewModel2}">
                            <Grid Margin="0,2">
                              <Grid.RowDefinitions>
                                <RowDefinition />
                              </Grid.RowDefinitions>

                              <StackPanel>
                                <TextBlock Text="{Binding Title}" />
                              </StackPanel>
                            </Grid>
                          </DataTemplate>
                        </ListBox.ItemTemplate>
                      </ListBox>
                    </DockPanel>
                </Grid>
              </Grid>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>
      </ScrollViewer>
    </Border>
  </DockPanel>
</Window>
